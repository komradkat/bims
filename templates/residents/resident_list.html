{% extends "layouts/base.html" %}

{% block title %}Residents Master List - BIMS{% endblock %}

{% block header_title %}Residents Master List{% endblock %}

{% block content %}
<div class="card" style="margin-bottom: 1.5rem;">
    <form method="get" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; align-items: end;">
        <div class="form-group" style="margin-bottom: 0;">
            <label class="form-label">Search</label>
            <input type="text" name="q" class="form-control" placeholder="Name or Address..." value="{{ request.GET.q }}">
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
            <label class="form-label">Sex</label>
            <select name="sex" class="form-control">
                <option value="">All</option>
                <option value="M" {% if request.GET.sex == 'M' %}selected{% endif %}>Male</option>
                <option value="F" {% if request.GET.sex == 'F' %}selected{% endif %}>Female</option>
            </select>
        </div>
        
        <div class="form-group" style="margin-bottom: 0;">
            <label class="form-label">Classification</label>
            <select name="classification" class="form-control">
                <option value="">All</option>
                {% for code, label in classifications %}
                    <option value="{{ code }}" {% if request.GET.classification == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
</div>

<div class="card" style="padding: 0; overflow: hidden;">
    <table class="data-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Sex</th>
                <th>Age</th>
                <th>Classification</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for resident in residents %}
            <tr>
                <td>
                    <div style="font-weight: 500;">{{ resident.last_name }}, {{ resident.first_name }}</div>
                </td>
                <td>{{ resident.get_sex_display }}</td>
                <td>{{ resident.birthdate|timesince }}</td>
                <td>
                    <span class="badge badge-info">{{ resident.get_classification_display }}</span>
                </td>
                <td>{{ resident.street_address }}</td>
                <td>
                    {% if resident.is_active %}
                        <span style="color: green;">Active</span>
                    {% else %}
                        <span style="color: red;">Inactive</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'admin:residents_resident_change' resident.id %}" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Edit</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 2rem; color: var(--color-text-secondary);">
                    No residents found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 0.5rem;">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-secondary">Previous</a>
    {% endif %}
    
    <span class="btn btn-secondary" style="pointer-events: none; background-color: var(--color-background);">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>
    
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn btn-secondary">Next</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
